

-- 
DROP TABLE IF EXISTS public.invoice_types;
CREATE TABLE IF NOT EXISTS public.invoice_types (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  invoice_name TEXT NOT NULL,
  code TEXT NOT NULL  
);

-- 
DROP TABLE IF EXISTS public.price_levels;
CREATE TABLE IF NOT EXISTS public.price_levels (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  level_name TEXT NOT NULL,
  code TEXT NOT NULL UNIQUE
);

-- 
DROP TABLE IF EXISTS public.items;
CREATE TABLE IF NOT EXISTS public.items (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  item_name TEXT NOT NULL,
  code TEXT NOT NULL UNIQUE,
  price NUMERIC NOT NULL DEFAULT 0
);

-- 
DROP TABLE IF EXISTS public.sales;
CREATE TABLE IF NOT EXISTS public.sales (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  invoice_type_id INT NULL REFERENCES public.invoice_types(id) ON DELETE SET NULL,
  invoice_no INT NOT NULL DEFAULT 0,
  sales_date timestamp NOT NULL DEFAULT now(),
  sub_total NUMERIC NOT NULL DEFAULT 0,
  total_due NUMERIC NOT NULL DEFAULT 0,
  tendered_amount NUMERIC NOT NULL DEFAULT 0,
  amount_paid NUMERIC NOT NULL DEFAULT 0,
  change_due NUMERIC NOT NULL DEFAULT 0,
  is_cancelled BOOLEAN NOT NULL DEFAULT FALSE
);

-- 
DROP TABLE IF EXISTS public.selections;
CREATE TABLE IF NOT EXISTS public.selections (
  id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  sales_id INT NOT NULL REFERENCES public.sales(id) ON DELETE cascade,
  item_id INT NULL REFERENCES public.items(id) ON DELETE SET NULL,
  price_level_id INT NULL REFERENCES public.price_levels(id) ON DELETE SET NULL,
  quantity INT NOT NULL DEFAULT 1,
  cost NUMERIC NOT NULL DEFAULT 0,
  price NUMERIC NOT NULL DEFAULT 0,
  total_price NUMERIC NOT NULL DEFAULT 0,
  total_quantity NUMERIC NOT NULL DEFAULT 1
);